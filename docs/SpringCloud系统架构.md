
# Spring Cloud Netflix概览和架构设计                            


### Spring Cloud简介Spring Cloud是基于Spring Boot的一整套实现微服务的框架。他提供了微服务开发所需的配置管理、服务发现、断路器、智能路由、微代理、控制总线、全局锁、决策竞选、分布式会话和集群状态管理等组件。最重要的是，跟spring boot框架一起使用的话，会让你开发微服务架构的云服务非常好的方便。  

Spring Cloud包含了非常多的子框架，其中，Spring Cloud Netflix是其中一套框架，由Netflix开发后来又并入Spring Cloud大家庭，它主要提供的模块包括：服务发现、断路器和监控、智能路由、客户端负载均衡等。  

Spring Cloud Netflix项目的时间还不长，并入Spring Cloud大家族还是2年前，所以相关的使用文档还比较少，除了官方文档，国内也有一个中文社区。但是，如果是刚开始接触这个，想使用它搭建一套微服务的应用架构，总是会有不知如何下手的感觉。所以，这篇文章就是从整体上来看看这个框架的各个组件、用处是什么、如何相互作用。最后再结合实际的经验，介绍一下可能会出现的问题，以及针对一些问题，采用什么样的解决方案。  

### 微服务架构首先，我们来看看一般的微服务架构需要的功能或使用场景：  

* 我们把整个系统根据业务拆分成几个子系统。
* 每个子系统可以部署多个应用，多个应用之间使用负载均衡。
* 需要一个服务注册中心，所有的服务都在注册中心注册，负载均衡也是通过在注册中心注册的服务来使用一定策略来实现。
* 所有的客户端都通过同一个网关地址访问后台的服务，通过路由配置，网关来判断一个URL请求由哪个服务处理。请求转发到服务上的时候也使用负载均衡。
* 服务之间有时候也需要相互访问。例如有一个用户模块，其他服务在处理一些业务的时候，要获取用户服务的用户数据。
* 需要一个断路器，及时处理服务调用时的超时和错误，防止由于其中一个服务的问题而导致整体系统的瘫痪。
* 还需要一个监控功能，监控每个服务调用花费的时间等。  

### Spring Cloud Netflix组件以及部署Spring Cloud Netflix框架刚好就满足了上面所有的需求，而且最重要的是，使用起来非常的简单。Spring Cloud Netflix包含的组件及其主要功能大致如下：  

* Eureka，服务注册和发现，它提供了一个服务注册中心、服务发现的客户端，还有一个方便的查看所有注册的服务的界面。 所有的服务使用Eureka的服务发现客户端来将自己注册到Eureka的服务器上。
* Zuul，网关，所有的客户端请求通过这个网关访问后台的服务。他可以使用一定的路由配置来判断某一个URL由哪个服务来处理。并从Eureka获取注册的服务来转发请求。
* Ribbon，即负载均衡，Zuul网关将一个请求发送给某一个服务的应用的时候，如果一个服务启动了多个实例，就会通过Ribbon来通过一定的负载均衡策略来发送给某一个服务实例。
* Feign，服务客户端，服务之间如果需要相互访问，可以使用RestTemplate，也可以使用Feign客户端访问。它默认会使用Ribbon来实现负载均衡。
* Hystrix，监控和断路器。我们只需要在服务接口上添加Hystrix标签，就可以实现对这个接口的监控和断路器功能。
* Hystrix Dashboard，监控面板，他提供了一个界面，可以监控各个服务上的服务调用所消耗的时间等。
* Turbine，监控聚合，使用Hystrix监控，我们需要打开每一个服务实例的监控信息来查看。而Turbine可以帮助我们把所有的服务实例的监控信息聚合到一个地方统一查看。这样就不需要挨个打开一个个的页面一个个查看。  

下面就是使用上述的子框架实现的为服务架构的组架构图：
![image](https://user-images.githubusercontent.com/11325103/26866724-04172992-4b95-11e7-9271-486465af3221.png)

![image](https://user-images.githubusercontent.com/11325103/26866853-8f35dafa-4b95-11e7-9095-c52c196853d2.png)
